# VPS Hardening - VersÃ£o Lite HÃ­brida

> ğŸ”’ Hardening otimizado para VPS compartilhada com Docker
> 
> âœ… SeguranÃ§a robusta  
> âœ… Leve e rÃ¡pido  
> âœ… Suporta autenticaÃ§Ã£o por senha (protegida)

## ğŸ¯ Para quem Ã© este script?

- âœ… VPS compartilhada (2-4 vCPU, 2-8GB RAM)
- âœ… Ambientes de desenvolvimento e testes
- âœ… Precisa de acesso via senha em mÃºltiplos computadores
- âœ… Usa Docker para aplicaÃ§Ãµes
- âœ… Quer seguranÃ§a sem complexidade

## âš¡ InstalaÃ§Ã£o RÃ¡pida (5 minutos)

### OpÃ§Ã£o 1: Script Bash (mais simples)

```bash
# 1. Conectar como root
ssh root@seu-servidor

# 2. Baixar script
wget https://raw.githubusercontent.com/SEU-REPO/vps-hardening-lite.sh
chmod +x vps-hardening-lite.sh

# 3. Executar
./vps-hardening-lite.sh

# 4. Definir senha para usuÃ¡rio docker
passwd docker

# 5. TESTAR em outra janela (NÃƒO FECHE A ATUAL!)
ssh docker@seu-servidor

# 6. Se funcionar, reinicie
reboot
```

### OpÃ§Ã£o 2: Ansible (mÃºltiplos servidores)

```bash
# 1. Instalar Ansible localmente
sudo apt install ansible

# 2. Criar inventÃ¡rio
cat > hosts.ini <<EOF
[vps]
meu-servidor ansible_host=IP_DO_SERVIDOR ansible_user=root
EOF

# 3. Executar
ansible-playbook -i hosts.ini vps-hardening-lite.yml

# 4. Definir senha
ssh root@seu-servidor
passwd docker
```

## ğŸ›¡ï¸ O que este script faz?

### âœ… SeguranÃ§a

- **SSH Hardening**: ProteÃ§Ã£o contra brute-force
- **Firewall**: UFW configurado + integraÃ§Ã£o Docker
- **fail2ban**: Bane IPs apÃ³s 3 tentativas falhas
- **AppArmor**: ProteÃ§Ã£o de containers
- **AtualizaÃ§Ãµes automÃ¡ticas**: Patches de seguranÃ§a
- **Kernel hardening**: ParÃ¢metros otimizados

### ğŸš€ Performance

- **Leve**: ~600MB RAM durante operaÃ§Ã£o
- **RÃ¡pido**: InstalaÃ§Ã£o em 8-12 minutos
- **Otimizado**: Docker com logs limitados
- **Limpeza automÃ¡tica**: Semanal

### ğŸ›ï¸ ConfiguraÃ§Ãµes

- **Docker**: Instalado e otimizado
- **UsuÃ¡rio docker**: Criado com permissÃµes adequadas
- **Chrony**: SincronizaÃ§Ã£o de tempo
- **Logs**: RotaÃ§Ã£o automÃ¡tica

## ğŸ“Š Antes vs Depois

| MÃ©trica | Antes | Depois |
|---------|-------|--------|
| Processos | ~80 | ~95 |
| RAM usado | ~200MB | ~500MB |
| Disco usado | ~1.5GB | ~3.5GB |
| SeguranÃ§a | âš ï¸ BÃ¡sica | âœ… Robusta |
| ManutenÃ§Ã£o | Manual | AutomÃ¡tica |

## ğŸ” SeguranÃ§a com Senha

Este script permite autenticaÃ§Ã£o por senha (diferente dos originais), mas com proteÃ§Ãµes:

- âœ… fail2ban configurado AGRESSIVAMENTE (3 tentativas = ban de 1h)
- âœ… Logs detalhados em `/var/log/auth.log`
- âœ… Root sÃ³ aceita chave SSH
- âœ… MaxAuthTries = 3
- âœ… ProteÃ§Ã£o contra SSH DDOS

**RecomendaÃ§Ã£o:** Use senha FORTE (16+ caracteres)

## ğŸ¯ PrÃ³ximos Passos ApÃ³s InstalaÃ§Ã£o

1. **Defina senha forte:**
   ```bash
   passwd docker
   ```

2. **TESTE SSH antes de desconectar:**
   ```bash
   ssh docker@seu-servidor
   ```

3. **Verifique serviÃ§os:**
   ```bash
   systemctl status docker fail2ban ufw chrony
   ```

4. **Monitore logs:**
   ```bash
   tail -f /var/log/auth.log
   fail2ban-client status sshd
   ```

5. **Configure backup externo**

## ğŸ”§ PersonalizaÃ§Ã£o

### Desabilitar senha depois (migrar para chave SSH):

```bash
# 1. Adicionar sua chave SSH
ssh-copy-id docker@seu-servidor

# 2. Testar
ssh docker@seu-servidor

# 3. Desabilitar senha
sudo sed -i 's/PasswordAuthentication yes/PasswordAuthentication no/' /etc/ssh/sshd_config.d/99-hardening.conf
sudo systemctl reload ssh
```

### Mudar porta SSH:

```bash
# Editar configuraÃ§Ã£o
sudo nano /etc/ssh/sshd_config.d/99-hardening.conf
# Mudar: Port 22 -> Port 2222

# Atualizar firewall
sudo ufw allow 2222/tcp
sudo ufw delete allow OpenSSH

# Reiniciar SSH
sudo systemctl reload ssh
```

### fail2ban mais agressivo:

```bash
sudo nano /etc/fail2ban/jail.local
# Mudar:
# maxretry = 2    (apenas 2 tentativas)
# bantime = 7200  (ban de 2 horas)

sudo systemctl restart fail2ban
```

## ğŸ“ Arquivos Importantes

- `/root/hardening-report.txt` - RelatÃ³rio completo
- `/var/log/auth.log` - Logs de autenticaÃ§Ã£o
- `/etc/ssh/sshd_config.d/99-hardening.conf` - Config SSH
- `/etc/fail2ban/jail.local` - Config fail2ban
- `/etc/docker/daemon.json` - Config Docker

## ğŸ†˜ Problemas Comuns

### SSH nÃ£o conecta

```bash
# Ver logs
tail -50 /var/log/auth.log

# Verificar serviÃ§o
systemctl status ssh

# Seu IP foi banido?
fail2ban-client status sshd
fail2ban-client set sshd unbanip SEU_IP
```

### Docker nÃ£o funciona

```bash
systemctl status docker
journalctl -u docker -n 50
systemctl restart docker
```

### Esqueci a senha

```bash
# Conecte como root (com chave SSH)
ssh root@seu-servidor
passwd docker
```

## ğŸ“š DocumentaÃ§Ã£o Completa

Veja `GUIA-COMPLETO.md` para:
- ComparaÃ§Ã£o detalhada com scripts originais
- Tabela completa de recursos
- Guia de troubleshooting
- ReferÃªncias e boas prÃ¡ticas

## âš ï¸ Avisos Importantes

1. **SEMPRE teste SSH em outra janela antes de desconectar**
2. **Use senha FORTE** se manter autenticaÃ§Ã£o por senha
3. **Configure backup externo** - este script nÃ£o faz backup
4. **Monitore logs regularmente**
5. **Mantenha o sistema atualizado**

## ğŸ¤ Contribuindo

Encontrou um bug? Tem uma sugestÃ£o?

1. Abra uma issue
2. Fork e faÃ§a um PR
3. Compartilhe sua experiÃªncia

## ğŸ“„ LicenÃ§a

MIT License - Use como quiser!

## ğŸ™ CrÃ©ditos

Baseado em:
- [rameerez/docker-host-hardening](https://gist.github.com/rameerez/238927b78f9108a71a77aed34208de11)
- CIS Ubuntu 22.04 Benchmark
- Docker Security Best Practices

---

**VersÃ£o:** 1.0.0  
**Ãšltima atualizaÃ§Ã£o:** Janeiro 2026  
**Compatibilidade:** Ubuntu 22.04+  
**Testado em:** DigitalOcean, Linode, Hetzner, Contabo

---

## ğŸš€ Comece Agora!

```bash
wget https://raw.githubusercontent.com/SEU-REPO/vps-hardening-lite.sh
chmod +x vps-hardening-lite.sh
sudo ./vps-hardening-lite.sh
```

**Tempo estimado:** 10 minutos  
**Resultado:** VPS segura e otimizada ğŸ”’
